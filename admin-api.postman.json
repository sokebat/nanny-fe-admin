{
  "info": {
    "_postman_id": "nannyplug-api-admin-internal-team",
    "name": "NannyPlug API - Admin Internal Team Management",
    "description": "Postman collection for internal admin & moderator management flows.\n\n**Base URL:** `{{base_url}}`\n\nThis collection covers:\n- Inviting internal team members (admins/moderators)\n- Resending invites\n- Deactivating internal team accounts\n- Completing invite (admin onboarding)\n- Admin 2-step login (password + email OTP)",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Admin Internal Auth Flows",
      "item": [
        {
          "name": "Admin - Complete Invite",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"token\": \"invite-token-from-email\",\n  \"password\": \"AdminSecurePass123!\",\n  \"confirmPassword\": \"AdminSecurePass123!\",\n  \"firstName\": \"Admin\",\n  \"lastName\": \"User\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/auth/admin/complete-invite",
              "host": ["{{base_url}}"],
              "path": ["auth", "admin", "complete-invite"]
            },
            "description": "Complete admin/moderator invite by setting password and activating the internal account.\n\n**Typical flow:**\n1. Admin sends invite via /admin/team/invite.\n2. Invitee clicks link from email (frontend reads `token` from query).\n3. Frontend calls this endpoint with `token` and new password."
          },
          "response": []
        },
        {
          "name": "Admin - Send Login OTP",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@example.com\",\n  \"password\": \"AdminSecurePass123!\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/auth/admin/send-login-otp",
              "host": ["{{base_url}}"],
              "path": ["auth", "admin", "send-login-otp"]
            },
            "description": "Admin login step 1.\n\nValidates email/password for an internal admin/moderator and sends a 6-digit OTP to their email. No tokens are returned here."
          },
          "response": []
        },
        {
          "name": "Admin - Verify Login OTP",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "  const jsonData = pm.response.json();",
                  "  if (jsonData.data && jsonData.data.accessToken) {",
                  "    pm.environment.set('access_token', jsonData.data.accessToken);",
                  "    pm.environment.set('refresh_token', jsonData.data.refreshToken);",
                  "    if (jsonData.data.user && jsonData.data.user.id) {",
                  "      pm.environment.set('user_id', jsonData.data.user.id);",
                  "    }",
                  "  }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@example.com\",\n  \"code\": \"123456\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/auth/admin/verify-login-otp",
              "host": ["{{base_url}}"],
              "path": ["auth", "admin", "verify-login-otp"]
            },
            "description": "Admin login step 2.\n\nVerifies the OTP sent to the admin's email and returns access/refresh tokens for admin dashboard access."
          },
          "response": []
        }
      ]
    },
    {
      "name": "Admin Internal Team Management",
      "item": [
        {
          "name": "Invite Team Member (Admin)",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{access_token}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"new.admin@example.com\",\n  \"role\": \"admin\",\n  \"firstName\": \"New\",\n  \"lastName\": \"Admin\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/admin/team/invite",
              "host": ["{{base_url}}"],
              "path": ["admin", "team", "invite"]
            },
            "description": "Invite a new internal team member (admin or moderator).\n\n**Requirements:**\n- Caller must be an authenticated admin (`role = admin`).\n\n**Effect:**\n- Creates an internal user with `isInternal = true`, `twoFactorRequired = true`.\n- Generates a one-time `inviteToken` and sends an invite email from `MAIL_FROM_HELLO`."
          },
          "response": []
        },
        {
          "name": "Resend Team Invite (Admin)",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{access_token}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"new.admin@example.com\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/admin/team/resend-invite",
              "host": ["{{base_url}}"],
              "path": ["admin", "team", "resend-invite"]
            },
            "description": "Resend an invite email (with a fresh token) to an existing internal team member by email.\n\n**Requirements:**\n- Caller must be an authenticated admin."
          },
          "response": []
        },
        {
          "name": "Deactivate Team Member (Admin)",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{access_token}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userId\": \"USER_ID_OF_TEAM_MEMBER\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/admin/team/deactivate",
              "host": ["{{base_url}}"],
              "path": ["admin", "team", "deactivate"]
            },
            "description": "Deactivate an internal team member account.\n\n**Effect:**\n- Sets `isActive = false`.\n- Clears any outstanding invite tokens.\n\n**Requirements:**\n- Caller must be an authenticated admin."
          },
          "response": []
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:3000/api",
      "type": "string"
    },
    {
      "key": "access_token",
      "value": "",
      "type": "string"
    },
    {
      "key": "refresh_token",
      "value": "",
      "type": "string"
    },
    {
      "key": "user_id",
      "value": "",
      "type": "string"
    }
  ]
}